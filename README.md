# Smart Dialogue Creator

Плагин предназначен для удобного и быстрого создания диалоговых сценариев.


# Глобальные настройки

Их можно найти в настройках проекта во вкладке **Game - Smart Dialogue Settings**.

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/eb8e1f16-1b6e-43b1-a000-e8975416da35)

Здесь есть настройки системы диалогов (они изменяют глобальное поведение системы):
**Character Data Asset** - ассет всех персонажей, которые используются в проекте (подробнее про него ниже).

**Public vars Data Asset** - ассет всех публичных переменных, которые используются в проекте

Настройки управления:

**Cooldown Phrase Skip** - Таймаут после скипа одного диалога, на скип следующего.

**Can Skip Hold** - Можно ли пропустить диалог по зажатой кнопке.

**Skip Dialogue Hold Duration** - Время, которое нужно зажимать кнопку пропуска чтобы пропустить катсцену или блок диалогов.

**... Keys** - массивы кнопок для управления диалогом

И настройки редактора: 

- **Player Scroll Width** - ширина текста проигрывателя диалогов в редакторе (в режиме DEBUGGING MODE)

- **Duration symbols per second** - Рассчёт времени показа фразы. Длительность фраз задается при выборе пункта контекстного меню Set Duration of Phrases. Например если указано значение 15 символов в секунду то для фразы длиной в 60 символов задастся Duration=60/15=4.0

- **Min auto duration phrase** - Минимальное время показа фразы. Для коротких фраз. Длительность фраз задается при выборе пункта контекстного меню Set Duration of Phrases. Например если указано значение 2 то для фразы длиной в 20 символов задастся Duration = Max(60/15=1.33, 2.0) = 2.0. Это значение также используется только для редактора.

**Внимание!** Длительность фраз не изменяется сразу для всех диалогов. Это значение используется только для редактора, берется для автоматического задания длительности фраз ветки с помощью контекстного меню.

- **Clipboard to Phrase** - настройка вставки из буфера обмена меню текста в текстовое поле фразы. Настройка изменяется в редакторе, но тут тоже присутствует. 

- **Phrase Editing Mode** - настройка позволяет при выборе фразы сразу же включать редактирование текста. Настройка изменяется в редакторе, но тут тоже присутствует.


# Character Data Asset

Ассет, содержащий базу данных всех персонажей. Создать его можно, нажав ПКМ в контент браузере и выбрав **Smart Dialogue->Character Data Asset**

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/d46a0aef-b6bf-4bc5-90a5-fe27dd976327)

При открытии ассета откроется **Characters Editor**


# Characters Editor

Редактор предназначен для создания, связывания и группировки по категориям сущностей персонажей, используемых в диалогах.

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/70dc4004-0700-46f3-ad77-983800e99247)

1. **Toolbar Panel** - содержит кнопки создания категории (Add Category) и персонажа в выбранной категории (Add Character). Также располагается кнопка валидации данных (Validate), при нажатии на которую в Output Log выводятся ошибки (или All Ok)

2. **Categories** - список всех категорий. При нажатии ПКМ в этой панели можно добавить или удалить категорию.

3. **Workspace** - рабочая облась. Здесь отображаются все персонажи входящие в выбранную категорию.

![DragDropCharacters](https://github.com/NIK0666/SDC_Documentation/assets/11288703/f28f767d-9d4d-4712-abac-19b61e8b6fb0)

- Перетаскиванием можно менять порядок персонажей в категории.

- Можно сменить категорию персонажа, перетащив его на другой пункт списка категорий. 

- Нажав ПКМ по персонажу можно дублировать или удалить персонажа, а нажав ПКМ на пустую область можно добавить персонажа. 

- Кликнув левой кнопкой мыши три раза по заголовку категории, можно перреименовать категорию.

4. **Details** - при выборе персонажа здесь отображаются его параметры.

- **Character Id** - уникальный идентификатор персонажа (английскими буквами, без пробелов)

- **Character Name** - имя персонажа (локализованный текст)

- **Character Icon** - портрет персонажа 

- **Name Color** - цвет текста имени персонажа (используется в проигрывателе диалогов в редакторе)

- **Phrase Color** - цвет фона фразы персонажа (используется в редакторе, цвет фона узлов фраз)

- **Variables** - объект сета переменных персонажа (я позже уберу из области видимости этот параметр)

- **Character Asset** - ACharacter ассет персонажа, используемого в игре.

Еще, рядом с вкладкой **Details** имеется вкладка **Variables** (о ней написано тут).


# Public Vars Editor

Редактор предназначен для создания глобальных переменных, которые по каким-то причинам нельзя отнести к конкретным персонажам и которые можно использовать для записи каких-то глобальных состояний игры.

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/34286a95-22ae-4027-a7b4-3ce82e22f88b)

- Слева располагается список категорий. При нажатии ПКМ в этой панели можно добавить или удалить категорию.

- Справа располагается список переменных категорий **Variables** (о ней написано ниже)


## Variables

Панель управления переменными. Имеется в редакторе публичных переменных, в редакторе персонажей и в редакторе диалогов. 

Если не создан сет переменных, то панель выглядит так:

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/ee18f0ad-04a8-40fc-987f-0cd8b9ffa2db)

При нажатии на кнопку Create Variables Set создается пустой сет переменных и становится активной кнопка Add Variable. Кнопка Remove Variables Set позволяет удалить сет переменных.

При нажатии на Add variable появляется диалоговое окно создания переменной

![VariablesAdd-20231017-140213](https://github.com/NIK0666/SDC_Documentation/assets/11288703/ad0f16c9-3096-43dc-9250-3b112fb82d6a)

Нужно ввести имя для создаваемой переменной. Также имеется выпадающий список, где нужно выбрать тип переменной

После создания появляется новая запись в списке. 

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/f81931f2-dec8-4ea2-8b9a-1a89266bdee4)

Здесь можно:

1. Изменить тип переменной

2. Изменить имя переменной

3. Задать дефолтное значение переменной

4. Удалить переменную из сета


# Smart Dialogue (ассет)

Ассет, содержащий граф диалога. Создать его можно, нажав ПКМ в контент браузере и выбрав **Smart Dialogue->Smart Dialogue**

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/acb05a1a-0ea4-4c67-8f9d-86ca288ff1cb)

При открытии ассета откроется **Smart Dialogue Editor**


# Smart Dialogue Editor

Редактор предназначен для создания диалоговых сценариев.

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/02083922-2956-4bfc-9ee1-9dffbd470aea)

Редактор имеет несколько режимов (1):

- **EDITING** - режим создания диалогов.

- **DEBUGGING** - режим проигрывания и отладки диалогов.

- **SEQUENCE** - режим для связывания катсцен с ветками диалогов.

Во всех режимах в редакторе отображается поле графа (2).

## Graph

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/398b142a-c6fc-40eb-91b2-7e96b1d8ac59)

Выполнение узлов устроено типичным для блюпринтов способом, логика выполняется слева направо. У каждого узла есть один вход и может быть один или два выхода (или вообще не быть выходов).

Каждый тип узла имеет свою иконку. Имена узлов можно переименовать, если выделить узел и два раза клинкуть по заголовку (или нажать F2):

![RenameNode](https://github.com/NIK0666/SDC_Documentation/assets/11288703/f5cd8391-8da4-470d-bf8a-954967e8f6e1)

Группу узлов можно объединять блоком комментария:

![CommentNodes](https://github.com/NIK0666/SDC_Documentation/assets/11288703/cbe7791e-fe12-4cbf-8647-a0e7de65da7b)

Нажатие кнопки Delete удаляет выделенные узлы.

Сочетание клавиш Ctrl+Z и Ctrl+Y отменяет или повторяетпоследнее действие.

Можно копировать, вырезать, дублировать выделенные узлы 

При нажатии ПКМ по пустой области графа появляется список узлов, которые можно создать.

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/be0d3324-114c-4c55-9691-37a4f9171757)

## Список узлов графа диалога

### Hub

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/5cb981bb-0527-4d70-b60b-27ef51e80d06)

  - От этого узла наследуются остальные узлы, кроме узлов **Change Started**, **Jump To** и **Simple Event**. 

  - Выполнение этого узла и его наследников начинается со входа и продолжается на выходе.
  
  - Может иметь сколько угодно входов и сколько угодно выходов.
  
  - Может быть полезен для соединения нескольких веток диалога в одну точку, иногда как стартовый хаб. Но по большей части вы не будете его использовать. 
  
  - При нажатии **ПКМ** можно выбрать пункт запуска выполнения диалога с выбранного узла

### Branch

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/85c393c3-044d-46ae-a451-e4aa90b4d037)

  - Основной узел для создания диалогов. В 90% случаев вы будете использовать его. 

  - Содержит реплику для показа в списке выбора реплик игрока. В данном случае на скрине изображено два узла веток диалога. И при проигрывании диалога игроку покажется две реплики:

    - Первая фраза, отображаемая в списке выбора вариантов ответа.

    - Вторая фраза, отображаемая в списке выбора вариантов ответа.

  - При выборе реплики игроком проигрываются поочередно фразы. О них в разделе ниже.

  - Когда заканчивается проигрывание всех фраз, выполнение диалога переходит дальше на Next

  - При двойном клике в области фразы реплики, или  при выбранном узле и наведении на фразу реплики нажатии на клавишу F2 включаеся режим редактирования реплики

  - Узел может содержать **Level Sequence** (о работе с секвенциями в рамках плагина можно почитать _тут_)

### Phrase

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/bfc5cbbe-3d24-4daf-9eda-68e715365f7a)

  - Это **subnode**, поэтому она отсутствует в списке основных узлов. Может быть создана внутри узла **Branch** или его наследников.

  - При нажатии **ПКМ** по узлу **Branch** появляется меню, с помощью которого можно создать новую фразу. Здесь нужно выбрать персонажа, который ее говорит. 

![AddPhrase](https://github.com/NIK0666/SDC_Documentation/assets/11288703/84aa9a43-0b5a-469e-b66f-6145bb3f9000)

  - Персонажи которые уже присутствовали в диалоге, отображаются в главном списке

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/060351d7-1cad-47e3-9c09-72ee415529bd)

  - При включенной опции режима EDITING тулбара Clipboard To Paste при создании новой фразы текст из буфера обмена записывается в текст узла фразы (подробнее в режиме EDITING)

  - При включенной опции режима EDITING тулбара Phrase editing mode при при выборе фразы сразу же включается редактирование текста (подробнее в режиме EDITING)

  - Можно перетаскивать узлы фраз между собой (менять порядок)

  - Можно копирывать **Ctrl+C**, вырезать **Ctrl+X**, вставлять **Ctrl+V**, дублировать **Ctrl+D**, удалять **Del** фразы.

### One Phrase

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/422a27be-f5da-4421-9b87-c3efc25b2983)

  - Узел наследуется от Branch. Предназначен для проигрывания одной фразы.

  - В шапке узла имеется булевый переключатель (синяя или серая иконка). 

    - При включенном состоянии, при проигрывании узла выбирается рандомно одна из всех фраз и после этого прододжается выполнение. В следующий раз выбирается снова рандомно фраза (но не последняя выбранная, если их больше одной).  

    - При выключенном состоянии, при проигрывании узла выбирается сначала первая фраза. При повторном вызове выбирается вторая фраза. Когда закончится список, снова выбирается первая фраза.
   
### Choice Hub

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/a7ad0ea2-1c88-4103-826d-9cf16b063e75)

  - Этот узел служит для идентификации точки выбора. Те ветки которые соединены после этого узла, будут показываться в выборе.

  - Список сортируется в зависимости от Y позиции узла идущего после Choice Hub. Но есть нюанс. При получении списка веток сначала проверяется **Index Proprity** ветки, а потом уже Y позиция.

  - Узел также содержит **Level Sequence** для цикличной анимации

  - Содержит опцию **Show One Answer** при включении которой, если с узлом соединена одна валидная ветка, то она показывается в списке выбора. Если же булевая не включена то последняя ветка выполняется автоматически. 

### Jump To

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/661ab446-70e5-451f-937a-10fdb6a0644d)

  - У него нет выходного пина.

  - Узел позволяет перейти на другой узел, как если бы вы просто простроили связь от одного узла к другому. На изображении ниже в обоих случаях произойдет переход с ветки 0 на ветку 6:

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/27410e4a-8704-4204-bd5f-6b461a72069e)

  - при даблклике по узлу типа **Jump To** граф фокусится на целевом узле.

  - При нажатии **ПКМ** по узлу можно выбрать пункт очистки целевого узла.

### Change Started

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/706ce02b-d362-4386-8eaf-46e771f1e5f8)

  - У этого узла тоже нет выходного пина, при даблклике **ПКМ** по узлу граф фокусится на целевом узле, при нажатии **ПКМ** по узлу можно выбрать пункт очистки целевого узла.

  - Узел позволяет задать стартовый узел типа **Hub** для запуска диалога с этого узла при следующем выполнении.

### Instructions

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/c6af74d7-0d02-4652-95b4-ef86b171047b)

  - С помощью этого узла можно менять значения переменным.

  - Также можно манипулировать состояниями **квестов** и **предметов** (об этом напишу отдельно).

  - В строке первый текстовый элемент - это имя переменной. Если в начале имени написано ключевое слово Private, то переменная относится к текущему диалогу. Если же в начале имени написан CharacterId персонажа, то переменная относится к персонажу. Также можно изменять публичные переменные (запись о них содержит имя категории)

  - После имени расположен выпадающий список операции. Для каждого типа есть свой список операций. При нажатии **ЛКМ** по этому полю появляется список, из которого можно выбрать нужное действие.

  - Третьим элементом строки расположено поле изменения значения.

  - Добавлять переменные в список можно нажатием **ПКМ** по этому узлу, далее в списке выбрать нужную переменную:

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/1aa7b97b-8f1b-4e54-b17c-da60c638f646)

  - Удалять инструкцию изменения переменной можно предварительно выделив ее в списке и далее нажав на клавишу Del на клавиатуре. 

### Conditions

![Conditions](https://github.com/NIK0666/SDC_Documentation/assets/11288703/80a0d952-6e49-4f7e-b0ef-d0e8c0cbecad)

  - С помощью этого узла можно задавать условия выполнения веток диалогов. 

  - У узла, в отличие от остальных, имеется два выхода. Если условия не выполняются, то выполнение цепочки продолжается по соединению из выхода **False**.

  - Можно добавлять **AND** и **OR** условия. Все условия **AND** должны выполниться обязательно для перехода в выход **Next**. Одно из условий **OR** должно выполниться для перехода в выход **Next**. 

  - Переменные для условий выбираются из приватных переменных диалога, публичных переменных и из переменных персонажей. 

  - В записи сначала пишется ключевое слово (**IF**, **OR**, **AND**), далее принадлежность и имя переменной, третим элементом условие сравнения (можно выбрать из списка, нажав на поле **ЛКМ**) и значение, с которым нужно сравнить.

  - При нажатии **ПКМ** по узлу появляется контекстное меню, из которого можно выбрать какую переменную добавить и какое условие ей задать (**OR** или **AND**)

  - Узел также работает с **предметами** и **квестами** (об этом напишу отдельно).

# Режимы редактора

## EDITING MODE

В этом режиме отображаются все вкладки для редактирования диалога. Также в этом режиме **toolbar** содержит кнопки для редактирования. 

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/c229a5dd-8a0f-4ed7-a8d5-eaf129053bc3)

  1. Слот стартового хаба диалога (с этого хаба начнется выполнение диалога по умолчанию). Задать хаб можно перетаскиванием из списка узлов (пример будет ниже).

  2. Опция **Clipboard to Phrase**. Если она включена, то при создании фразы ее текст автоматически заполняется из буфера обмена. Удобно для заполнения диалога. 

![FromClipboard](https://github.com/NIK0666/SDC_Documentation/assets/11288703/b072cd3e-fd2c-4184-978d-ad111df9049e)

  3. Опция **Phrase editing mode**. Если она включена, то при выбре узла фразы сразу же включается редактирование текста.

  4. Опция **Export to String Table**. Сохраняет текст в таблицу строк и текст нативного языка будет браться из таблицы. Также изменять текст на других языках можно **только** если нативный текст берется из таблиц. Таблица создается в папке StringTables в том же каталоге где ассет диалога. Имеет такое же имя как имя ассета диалога за исключением префикса.

### Details

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/1c28faea-bdd1-4773-a201-08aa16da62bf)

  - Здесь отображаются параметры выбранного узла. Иногда (например в случае с узлом блока комментария) они нужны, но в большинстве случаев работать в редаткоре можно без этой панели.

  - У всех узлов без исключения есть параметр **Index Proprity**. Он иногда полезен, когда нужно в списке выбора показать вариант не по Y позиции на графе. При получении списка веток сначала проверяется Index Proprity, а потом уже Y позиция.

  - У Branch, One Phrase и Choice Hub в списке свойств присутствует **Level Sequence**. Так то она заполняется при работе в режиме **SEQUENCER**, но в своствах можно изменить ассет.

### Nodes List

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/50b6caea-f6ed-47a3-8084-05cdabc6a680)

  - Содержит список всех размещенных узлов на граф (кроме комментариев и фраз)

  - Можно искать по тексту нужный узел:

![SearchNode](https://github.com/NIK0666/SDC_Documentation/assets/11288703/f78f0a80-785f-4933-8511-495827924b6d)

  - Можно сортировать список по расположению узлов. Автоматически пока не сортирует (возможно сделаю сортировку автоматически перед сохранением)

![SortNodes](https://github.com/NIK0666/SDC_Documentation/assets/11288703/bfff04bf-6936-44e0-9cf8-2392b04f8750)

  - При выборе элемента списка граф фокусится на выбранном узле.

  - Перетаскиванием можно назначить цель узлам типа Jump To, Change Started, а так же можно назначить стартовый узел по умолчанию для текущего диалога.

![DragDropListElement](https://github.com/NIK0666/SDC_Documentation/assets/11288703/ecdea3d2-4392-4281-a604-605a3d1e09b1)

### Variables

![image](https://github.com/NIK0666/SDC_Documentation/assets/11288703/4e44921e-a4db-48a3-9f9c-6c5fd4c80590)

  - Содержит список приватных переменных диалога

  - В разделе выше **Variables** уже было описано, как раотать с переменными

### Items и Quests

  - в этих панелях распологаются списки предметов и квестов.

  - о работе с предметами и квестами напишу отдельно.

## DEBUGGING MODE

Режим предназначен для проигрывания и отладки созданных диалоговых сценариев.

